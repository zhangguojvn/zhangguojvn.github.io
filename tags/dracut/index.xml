<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Dracut on 张某的博客</title>
    <link>https://zhangguojvn.github.io/tags/dracut/</link>
    <description>Recent content in Dracut on 张某的博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Thu, 12 May 2022 23:40:37 +0800</lastBuildDate><atom:link href="https://zhangguojvn.github.io/tags/dracut/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Dracut 原生挂载 OverlayFS Root</title>
      <link>https://zhangguojvn.github.io/posts/dracut-%E5%8E%9F%E7%94%9F%E6%8C%82%E8%BD%BD-overlayfs-root/</link>
      <pubDate>Thu, 12 May 2022 23:40:37 +0800</pubDate>
      
      <guid>https://zhangguojvn.github.io/posts/dracut-%E5%8E%9F%E7%94%9F%E6%8C%82%E8%BD%BD-overlayfs-root/</guid>
      <description>Dracut 配置 需要手动导入模块，不可以使用hostonly模式，即配置中hostonly=&amp;quot;no&amp;quot;。
/etc/dracut.conf ---------- hostonly=&amp;#34;no&amp;#34; add_drivers+=&amp;#34; squashfs overlay &amp;#34; add_dracutmodules+=&amp;#34; dmsquash-live &amp;#34; 因为关闭了 hostonly 模式，所以 lvm 等配置需要手动写入内核参数。
准备镜像 镜像可以放入可挂载文件系统，或直接烧录进分区。在此介绍放入挂载文件系统情况。
镜像内部至少需要 proc,sys,dev。其中 90dmsquash-live 使用 /proc 检测是否为正确的系统格式。98dracut-systemd 使用 usable_root() 函数，该函数使用 /proc,/sys,/dev 检测是否和正确的系统格式。建议也创建 /run 文件夹。
镜像放在内核参数&amp;lt;rd.live.dir&amp;gt;/&amp;lt;rd.live.squashimg&amp;gt;。这两个参数默认值为 LiveOS 和 squashfs.img 即默认放入 LiveOS/squashfs.img 即可。
OverlayFS 持久化分区准备 该分区需要在根目录下创建内核参数 &amp;lt;rd.live.overlay&amp;gt; 目录作为 upperdir。并且在上级目录创建 ovlwork 文件夹作为 workdir。&amp;lt;rd.live.overlay&amp;gt;默认为`/&amp;lt;rd.live.dir&amp;gt;/overlay--&amp;quot;,其中LABEL和UUID为ROOT分区的LABEL和UUID。持久化不仅可以用文件夹，也可以使用文件，在此不介绍。
内核参数 root=live:分区: 存放镜像的分区。 rd.live.overlay=分区:目录: OverlayFS 的 upperdir，目录必须由/开头。 rootfstype=ext4: root 分区的文件类型。 </description>
    </item>
    
    <item>
      <title>Dracut 开机自动创建 Lvm 快照</title>
      <link>https://zhangguojvn.github.io/posts/dracut-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA-lvm-%E5%BF%AB%E7%85%A7/</link>
      <pubDate>Sat, 30 Apr 2022 17:09:57 +0800</pubDate>
      
      <guid>https://zhangguojvn.github.io/posts/dracut-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA-lvm-%E5%BF%AB%E7%85%A7/</guid>
      <description>Dracut-056之前版本 内核参数加入以下参数即可,其中 ORIG_LV 为快照源, SNAP_LV 为快照名.每次启动都会删除 SNAP_LV 并创建新的 SNAP_LV .
rd.lvm.snapshot=&amp;#34;ORIG_LV:SNAP_LV&amp;#34; Dracut-056及之后版本 在Dracut-056中删除了快照功能，需要自己创建快照脚本。</description>
    </item>
    
  </channel>
</rss>
